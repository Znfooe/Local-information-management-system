import { createHotContext as __vite__createHotContext } from "/@vite/client";import.meta.hot = __vite__createHotContext("/src/pages/AiAgent.tsx");import __vite__cjsImport0_react_jsxDevRuntime from "/node_modules/.vite/deps/react_jsx-dev-runtime.js?v=35fb60bd"; const jsxDEV = __vite__cjsImport0_react_jsxDevRuntime["jsxDEV"];
var _s = $RefreshSig$();
import __vite__cjsImport1_react from "/node_modules/.vite/deps/react.js?v=35fb60bd"; const useState = __vite__cjsImport1_react["useState"]; const useRef = __vite__cjsImport1_react["useRef"]; const useEffect = __vite__cjsImport1_react["useEffect"];
import { useTranslation } from "/node_modules/.vite/deps/react-i18next.js?v=35fb60bd";
import { toast } from "/node_modules/.vite/deps/sonner.js?v=35fb60bd";
import { Button } from "/src/components/ui/button.tsx";
import { Input } from "/src/components/ui/input.tsx";
import { ScrollArea } from "/src/components/ui/scroll-area.tsx";
import { Card } from "/src/components/ui/card.tsx";
import { Send, Bot, User, Settings2 } from "/node_modules/.vite/deps/lucide-react.js?v=35fb60bd";
import axios from "/node_modules/.vite/deps/axios.js?v=35fb60bd";
import { db } from "/src/lib/db.ts?t=1769665656611";
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
  DialogDescription
} from "/src/components/ui/dialog.tsx";
import { Label } from "/src/components/ui/label.tsx";
import { Textarea } from "/src/components/ui/textarea.tsx";
export default function AiAgent() {
  _s();
  const { t } = useTranslation();
  const [messages, setMessages] = useState([]);
  const [input, setInput] = useState("");
  const [isLoading, setIsLoading] = useState(false);
  const scrollRef = useRef(null);
  const [systemPrompt, setSystemPrompt] = useState("你是一个乐于助人的AI助手。");
  const [apiKey, setApiKey] = useState("12b3cf51ba064a46b68ecc6bbd5b31ec.kwa9yPoUIxDxJ16J");
  const [model, setModel] = useState("glm-4-flash");
  useEffect(() => {
    const loadSettings = async () => {
      const settings = await db.getSettings();
      if (settings.apiKey) setApiKey(settings.apiKey);
      if (settings.model) setModel(settings.model);
      if (settings.systemPrompt) setSystemPrompt(settings.systemPrompt);
      const history = await db.getChatHistory();
      if (history && history.length > 0) {
        setMessages(history);
      }
    };
    loadSettings();
  }, []);
  useEffect(() => {
    if (messages.length > 0) {
      db.saveChatHistory(messages);
    }
  }, [messages]);
  const saveConfig = async () => {
    if (!apiKey.trim()) {
      toast.error(t("ai.key.empty"));
      return;
    }
    try {
      await db.saveSettings({ apiKey, model, systemPrompt });
      toast.success(t("ai.config.saved"));
    } catch (error) {
      console.error("Save config error:", error);
      toast.error(t("ai.config.failed"));
    }
  };
  useEffect(() => {
    if (scrollRef.current) {
      scrollRef.current.scrollIntoView({ behavior: "smooth" });
    }
  }, [messages]);
  const handleSend = async () => {
    if (!input.trim()) return;
    if (!apiKey) {
      toast.error(t("ai.key.missing"));
      return;
    }
    const userMsg = { role: "user", content: input };
    setMessages((prev) => [...prev, userMsg]);
    setInput("");
    setIsLoading(true);
    try {
      const conversation = [
        { role: "system", content: systemPrompt },
        ...messages,
        userMsg
      ];
      const response = await axios.post(
        "https://open.bigmodel.cn/api/paas/v4/chat/completions",
        {
          model,
          messages: conversation,
          stream: false
        },
        {
          headers: {
            "Authorization": `Bearer ${apiKey}`,
            "Content-Type": "application/json"
          }
        }
      );
      const aiMsg = {
        role: "assistant",
        content: response.data.choices[0].message.content
      };
      setMessages((prev) => [...prev, aiMsg]);
    } catch (error) {
      console.error("AI Error:", error);
      toast.error(t("ai.request.failed"));
      const errorMsg = {
        role: "assistant",
        content: `Error: ${error.response?.data?.error?.message || error.message}`
      };
      setMessages((prev) => [...prev, errorMsg]);
    } finally {
      setIsLoading(false);
    }
  };
  return /* @__PURE__ */ jsxDEV("div", { className: "flex flex-col h-full space-y-4", children: [
    /* @__PURE__ */ jsxDEV("div", { className: "flex items-center justify-between border-b pb-4", children: [
      /* @__PURE__ */ jsxDEV("h2", { className: "text-2xl font-bold flex items-center gap-2", children: [
        /* @__PURE__ */ jsxDEV(Bot, { className: "h-6 w-6" }, void 0, false, {
          fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
          lineNumber: 141,
          columnNumber: 11
        }, this),
        " ",
        t("nav.ai")
      ] }, void 0, true, {
        fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
        lineNumber: 140,
        columnNumber: 9
      }, this),
      /* @__PURE__ */ jsxDEV(Dialog, { children: [
        /* @__PURE__ */ jsxDEV(DialogTrigger, { asChild: true, children: /* @__PURE__ */ jsxDEV(Button, { variant: "outline", size: "sm", children: [
          /* @__PURE__ */ jsxDEV(Settings2, { className: "h-4 w-4 mr-2" }, void 0, false, {
            fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
            lineNumber: 147,
            columnNumber: 15
          }, this),
          " ",
          t("ai.settings")
        ] }, void 0, true, {
          fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
          lineNumber: 146,
          columnNumber: 13
        }, this) }, void 0, false, {
          fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
          lineNumber: 145,
          columnNumber: 11
        }, this),
        /* @__PURE__ */ jsxDEV(DialogContent, { children: [
          /* @__PURE__ */ jsxDEV(DialogHeader, { children: [
            /* @__PURE__ */ jsxDEV(DialogTitle, { children: t("ai.config.title") }, void 0, false, {
              fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
              lineNumber: 152,
              columnNumber: 15
            }, this),
            /* @__PURE__ */ jsxDEV(DialogDescription, { children: t("ai.config.desc") }, void 0, false, {
              fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
              lineNumber: 153,
              columnNumber: 15
            }, this)
          ] }, void 0, true, {
            fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
            lineNumber: 151,
            columnNumber: 13
          }, this),
          /* @__PURE__ */ jsxDEV("div", { className: "space-y-4 py-4", children: [
            /* @__PURE__ */ jsxDEV("div", { className: "grid gap-2", children: [
              /* @__PURE__ */ jsxDEV(Label, { children: t("ai.system.label") }, void 0, false, {
                fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
                lineNumber: 159,
                columnNumber: 17
              }, this),
              /* @__PURE__ */ jsxDEV(
                Textarea,
                {
                  value: systemPrompt,
                  onChange: (e) => setSystemPrompt(e.target.value),
                  placeholder: t("ai.system.placeholder"),
                  className: "h-24"
                },
                void 0,
                false,
                {
                  fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
                  lineNumber: 160,
                  columnNumber: 17
                },
                this
              )
            ] }, void 0, true, {
              fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
              lineNumber: 158,
              columnNumber: 15
            }, this),
            /* @__PURE__ */ jsxDEV("div", { className: "grid gap-2", children: [
              /* @__PURE__ */ jsxDEV(Label, { children: t("ai.key.label") }, void 0, false, {
                fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
                lineNumber: 168,
                columnNumber: 17
              }, this),
              /* @__PURE__ */ jsxDEV(
                Input,
                {
                  value: apiKey,
                  onChange: (e) => setApiKey(e.target.value),
                  type: "password",
                  placeholder: t("ai.key.placeholder")
                },
                void 0,
                false,
                {
                  fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
                  lineNumber: 169,
                  columnNumber: 17
                },
                this
              ),
              /* @__PURE__ */ jsxDEV("p", { className: "text-xs text-muted-foreground", children: [
                t("ai.key.help"),
                " ",
                /* @__PURE__ */ jsxDEV("a", { href: "https://open.bigmodel.cn/", target: "_blank", className: "underline", children: "open.bigmodel.cn" }, void 0, false, {
                  fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
                  lineNumber: 176,
                  columnNumber: 38
                }, this)
              ] }, void 0, true, {
                fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
                lineNumber: 175,
                columnNumber: 17
              }, this)
            ] }, void 0, true, {
              fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
              lineNumber: 167,
              columnNumber: 15
            }, this),
            /* @__PURE__ */ jsxDEV("div", { className: "grid gap-2", children: [
              /* @__PURE__ */ jsxDEV(Label, { children: t("ai.model.label") }, void 0, false, {
                fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
                lineNumber: 180,
                columnNumber: 17
              }, this),
              /* @__PURE__ */ jsxDEV(
                Input,
                {
                  value: model,
                  onChange: (e) => setModel(e.target.value),
                  placeholder: t("ai.model.placeholder")
                },
                void 0,
                false,
                {
                  fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
                  lineNumber: 181,
                  columnNumber: 17
                },
                this
              )
            ] }, void 0, true, {
              fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
              lineNumber: 179,
              columnNumber: 15
            }, this),
            /* @__PURE__ */ jsxDEV(Button, { onClick: saveConfig, className: "w-full", children: t("ai.save") }, void 0, false, {
              fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
              lineNumber: 187,
              columnNumber: 15
            }, this)
          ] }, void 0, true, {
            fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
            lineNumber: 157,
            columnNumber: 13
          }, this)
        ] }, void 0, true, {
          fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
          lineNumber: 150,
          columnNumber: 11
        }, this)
      ] }, void 0, true, {
        fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
        lineNumber: 144,
        columnNumber: 9
      }, this)
    ] }, void 0, true, {
      fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
      lineNumber: 139,
      columnNumber: 7
    }, this),
    /* @__PURE__ */ jsxDEV(Card, { className: "flex-1 p-4 overflow-hidden flex flex-col bg-muted/30", children: [
      /* @__PURE__ */ jsxDEV(ScrollArea, { className: "flex-1 pr-4", children: /* @__PURE__ */ jsxDEV("div", { className: "space-y-4", children: [
        messages.length === 0 && /* @__PURE__ */ jsxDEV("div", { className: "text-center text-muted-foreground mt-20", children: [
          /* @__PURE__ */ jsxDEV(Bot, { className: "h-12 w-12 mx-auto mb-4 opacity-50" }, void 0, false, {
            fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
            lineNumber: 198,
            columnNumber: 17
          }, this),
          /* @__PURE__ */ jsxDEV("p", { children: t("ai.start") }, void 0, false, {
            fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
            lineNumber: 199,
            columnNumber: 17
          }, this)
        ] }, void 0, true, {
          fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
          lineNumber: 197,
          columnNumber: 13
        }, this),
        messages.map(
          (msg, i) => /* @__PURE__ */ jsxDEV(
            "div",
            {
              className: `flex ${msg.role === "user" ? "justify-end" : "justify-start"}`,
              children: /* @__PURE__ */ jsxDEV(
                "div",
                {
                  className: `flex gap-3 max-w-[80%] ${msg.role === "user" ? "flex-row-reverse" : "flex-row"}`,
                  children: [
                    /* @__PURE__ */ jsxDEV("div", { className: `h-8 w-8 rounded-full flex items-center justify-center shrink-0 ${msg.role === "user" ? "bg-primary text-primary-foreground" : "bg-secondary"}`, children: msg.role === "user" ? /* @__PURE__ */ jsxDEV(User, { className: "h-5 w-5" }, void 0, false, {
                      fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
                      lineNumber: 217,
                      columnNumber: 44
                    }, this) : /* @__PURE__ */ jsxDEV(Bot, { className: "h-5 w-5" }, void 0, false, {
                      fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
                      lineNumber: 217,
                      columnNumber: 75
                    }, this) }, void 0, false, {
                      fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
                      lineNumber: 214,
                      columnNumber: 19
                    }, this),
                    /* @__PURE__ */ jsxDEV(
                      "div",
                      {
                        className: `p-3 rounded-lg text-sm whitespace-pre-wrap ${msg.role === "user" ? "bg-primary text-primary-foreground" : "bg-card border shadow-sm"}`,
                        children: msg.content
                      },
                      void 0,
                      false,
                      {
                        fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
                        lineNumber: 219,
                        columnNumber: 19
                      },
                      this
                    )
                  ]
                },
                void 0,
                true,
                {
                  fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
                  lineNumber: 209,
                  columnNumber: 17
                },
                this
              )
            },
            i,
            false,
            {
              fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
              lineNumber: 203,
              columnNumber: 13
            },
            this
          )
        ),
        isLoading && /* @__PURE__ */ jsxDEV("div", { className: "flex justify-start", children: /* @__PURE__ */ jsxDEV("div", { className: "bg-card border p-3 rounded-lg text-sm shadow-sm", children: t("ai.thinking") }, void 0, false, {
          fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
          lineNumber: 233,
          columnNumber: 18
        }, this) }, void 0, false, {
          fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
          lineNumber: 232,
          columnNumber: 13
        }, this),
        /* @__PURE__ */ jsxDEV("div", { ref: scrollRef }, void 0, false, {
          fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
          lineNumber: 238,
          columnNumber: 13
        }, this)
      ] }, void 0, true, {
        fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
        lineNumber: 195,
        columnNumber: 11
      }, this) }, void 0, false, {
        fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
        lineNumber: 194,
        columnNumber: 9
      }, this),
      /* @__PURE__ */ jsxDEV("div", { className: "pt-4 mt-2 flex gap-2", children: [
        /* @__PURE__ */ jsxDEV(
          Textarea,
          {
            value: input,
            onChange: (e) => setInput(e.target.value),
            onKeyDown: (e) => e.key === "Enter" && !e.shiftKey && handleSend(),
            placeholder: t("ai.placeholder"),
            disabled: isLoading,
            className: "flex-1"
          },
          void 0,
          false,
          {
            fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
            lineNumber: 243,
            columnNumber: 11
          },
          this
        ),
        /* @__PURE__ */ jsxDEV(Button, { onClick: handleSend, disabled: isLoading, children: /* @__PURE__ */ jsxDEV(Send, { className: "h-4 w-4" }, void 0, false, {
          fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
          lineNumber: 252,
          columnNumber: 13
        }, this) }, void 0, false, {
          fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
          lineNumber: 251,
          columnNumber: 11
        }, this)
      ] }, void 0, true, {
        fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
        lineNumber: 242,
        columnNumber: 9
      }, this)
    ] }, void 0, true, {
      fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
      lineNumber: 193,
      columnNumber: 7
    }, this)
  ] }, void 0, true, {
    fileName: "D:/桌面端应用plus/app/src/pages/AiAgent.tsx",
    lineNumber: 138,
    columnNumber: 5
  }, this);
}
_s(AiAgent, "t9+Z+CoMniOCTtHoqn8ujJN4QcQ=", false, function() {
  return [useTranslation];
});
_c = AiAgent;
var _c;
$RefreshReg$(_c, "AiAgent");
import * as RefreshRuntime from "/@react-refresh";
const inWebWorker = typeof WorkerGlobalScope !== "undefined" && self instanceof WorkerGlobalScope;
if (import.meta.hot && !inWebWorker) {
  if (!window.$RefreshReg$) {
    throw new Error(
      "@vitejs/plugin-react can't detect preamble. Something is wrong."
    );
  }
  RefreshRuntime.__hmr_import(import.meta.url).then((currentExports) => {
    RefreshRuntime.registerExportsForReactRefresh("D:/桌面端应用plus/app/src/pages/AiAgent.tsx", currentExports);
    import.meta.hot.accept((nextExports) => {
      if (!nextExports) return;
      const invalidateMessage = RefreshRuntime.validateRefreshBoundaryAndEnqueueUpdate("D:/桌面端应用plus/app/src/pages/AiAgent.tsx", currentExports, nextExports);
      if (invalidateMessage) import.meta.hot.invalidate(invalidateMessage);
    });
  });
}
function $RefreshReg$(type, id) {
  return RefreshRuntime.register(type, "D:/桌面端应用plus/app/src/pages/AiAgent.tsx " + id);
}
function $RefreshSig$() {
  return RefreshRuntime.createSignatureFunctionForTransform();
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJtYXBwaW5ncyI6IkFBNElVOztBQTVJVixTQUFTQSxVQUFVQyxRQUFRQyxpQkFBaUI7QUFDNUMsU0FBU0Msc0JBQXNCO0FBQy9CLFNBQVNDLGFBQWE7QUFDdEIsU0FBU0MsY0FBYztBQUN2QixTQUFTQyxhQUFhO0FBQ3RCLFNBQVNDLGtCQUFrQjtBQUMzQixTQUFTQyxZQUFZO0FBQ3JCLFNBQVNDLE1BQU1DLEtBQUtDLE1BQU1DLGlCQUFpQjtBQUMzQyxPQUFPQyxXQUFXO0FBQ2xCLFNBQVNDLFVBQVU7QUFDbkI7QUFBQSxFQUNFQztBQUFBQSxFQUNBQztBQUFBQSxFQUNBQztBQUFBQSxFQUNBQztBQUFBQSxFQUNBQztBQUFBQSxFQUNBQztBQUFBQSxPQUNLO0FBQ1AsU0FBU0MsYUFBYTtBQUN0QixTQUFTQyxnQkFBZ0I7QUFPekIsd0JBQXdCQyxVQUFVO0FBQUFDLEtBQUE7QUFDaEMsUUFBTSxFQUFFQyxFQUFFLElBQUl0QixlQUFlO0FBQzdCLFFBQU0sQ0FBQ3VCLFVBQVVDLFdBQVcsSUFBSTNCLFNBQW9CLEVBQUU7QUFDdEQsUUFBTSxDQUFDNEIsT0FBT0MsUUFBUSxJQUFJN0IsU0FBUyxFQUFFO0FBQ3JDLFFBQU0sQ0FBQzhCLFdBQVdDLFlBQVksSUFBSS9CLFNBQVMsS0FBSztBQUNoRCxRQUFNZ0MsWUFBWS9CLE9BQXVCLElBQUk7QUFHN0MsUUFBTSxDQUFDZ0MsY0FBY0MsZUFBZSxJQUFJbEMsU0FBUyxnQkFBZ0I7QUFDakUsUUFBTSxDQUFDbUMsUUFBUUMsU0FBUyxJQUFJcEMsU0FBUyxtREFBbUQ7QUFDeEYsUUFBTSxDQUFDcUMsT0FBT0MsUUFBUSxJQUFJdEMsU0FBUyxhQUFhO0FBRWhERSxZQUFVLE1BQU07QUFFZCxVQUFNcUMsZUFBZSxZQUFZO0FBQy9CLFlBQU1DLFdBQVcsTUFBTTFCLEdBQUcyQixZQUFZO0FBQ3RDLFVBQUlELFNBQVNMLE9BQVFDLFdBQVVJLFNBQVNMLE1BQU07QUFDOUMsVUFBSUssU0FBU0gsTUFBT0MsVUFBU0UsU0FBU0gsS0FBSztBQUMzQyxVQUFJRyxTQUFTUCxhQUFjQyxpQkFBZ0JNLFNBQVNQLFlBQVk7QUFHaEUsWUFBTVMsVUFBVSxNQUFNNUIsR0FBRzZCLGVBQWU7QUFDeEMsVUFBSUQsV0FBV0EsUUFBUUUsU0FBUyxHQUFHO0FBQ2pDakIsb0JBQVllLE9BQU87QUFBQSxNQUNyQjtBQUFBLElBQ0Y7QUFDQUgsaUJBQWE7QUFBQSxFQUNmLEdBQUcsRUFBRTtBQUdMckMsWUFBVSxNQUFNO0FBQ2QsUUFBSXdCLFNBQVNrQixTQUFTLEdBQUc7QUFDdkI5QixTQUFHK0IsZ0JBQWdCbkIsUUFBUTtBQUFBLElBQzdCO0FBQUEsRUFDRixHQUFHLENBQUNBLFFBQVEsQ0FBQztBQUViLFFBQU1vQixhQUFhLFlBQVk7QUFDN0IsUUFBSSxDQUFDWCxPQUFPWSxLQUFLLEdBQUc7QUFDbEIzQyxZQUFNNEMsTUFBTXZCLEVBQUUsY0FBYyxDQUFDO0FBQzdCO0FBQUEsSUFDRjtBQUNBLFFBQUk7QUFDRixZQUFNWCxHQUFHbUMsYUFBYSxFQUFFZCxRQUFRRSxPQUFPSixhQUFhLENBQUM7QUFDckQ3QixZQUFNOEMsUUFBUXpCLEVBQUUsaUJBQWlCLENBQUM7QUFBQSxJQUNwQyxTQUFTdUIsT0FBTztBQUNkRyxjQUFRSCxNQUFNLHNCQUFzQkEsS0FBSztBQUN6QzVDLFlBQU00QyxNQUFNdkIsRUFBRSxrQkFBa0IsQ0FBQztBQUFBLElBQ25DO0FBQUEsRUFDRjtBQUVBdkIsWUFBVSxNQUFNO0FBQ2QsUUFBSThCLFVBQVVvQixTQUFTO0FBQ3JCcEIsZ0JBQVVvQixRQUFRQyxlQUFlLEVBQUVDLFVBQVUsU0FBUyxDQUFDO0FBQUEsSUFDekQ7QUFBQSxFQUNGLEdBQUcsQ0FBQzVCLFFBQVEsQ0FBQztBQUViLFFBQU02QixhQUFhLFlBQVk7QUFDN0IsUUFBSSxDQUFDM0IsTUFBTW1CLEtBQUssRUFBRztBQUNuQixRQUFJLENBQUNaLFFBQVE7QUFDWC9CLFlBQU00QyxNQUFNdkIsRUFBRSxnQkFBZ0IsQ0FBQztBQUMvQjtBQUFBLElBQ0Y7QUFFQSxVQUFNK0IsVUFBbUIsRUFBRUMsTUFBTSxRQUFRQyxTQUFTOUIsTUFBTTtBQUN4REQsZ0JBQVksQ0FBQ2dDLFNBQVMsQ0FBQyxHQUFHQSxNQUFNSCxPQUFPLENBQUM7QUFDeEMzQixhQUFTLEVBQUU7QUFDWEUsaUJBQWEsSUFBSTtBQUVqQixRQUFJO0FBQ0YsWUFBTTZCLGVBQWU7QUFBQSxRQUNuQixFQUFFSCxNQUFNLFVBQVVDLFNBQVN6QixhQUFhO0FBQUEsUUFDeEMsR0FBR1A7QUFBQUEsUUFDSDhCO0FBQUFBLE1BQU87QUFJVCxZQUFNSyxXQUFXLE1BQU1oRCxNQUFNaUQ7QUFBQUEsUUFDM0I7QUFBQSxRQUNBO0FBQUEsVUFDRXpCO0FBQUFBLFVBQ0FYLFVBQVVrQztBQUFBQSxVQUNWRyxRQUFRO0FBQUEsUUFDVjtBQUFBLFFBQ0E7QUFBQSxVQUNFQyxTQUFTO0FBQUEsWUFDUCxpQkFBaUIsVUFBVTdCLE1BQU07QUFBQSxZQUNqQyxnQkFBZ0I7QUFBQSxVQUNsQjtBQUFBLFFBQ0Y7QUFBQSxNQUNGO0FBRUEsWUFBTThCLFFBQWlCO0FBQUEsUUFDckJSLE1BQU07QUFBQSxRQUNOQyxTQUFTRyxTQUFTSyxLQUFLQyxRQUFRLENBQUMsRUFBRUMsUUFBUVY7QUFBQUEsTUFDNUM7QUFDQS9CLGtCQUFZLENBQUNnQyxTQUFTLENBQUMsR0FBR0EsTUFBTU0sS0FBSyxDQUFDO0FBQUEsSUFFeEMsU0FBU2pCLE9BQVk7QUFDbkJHLGNBQVFILE1BQU0sYUFBYUEsS0FBSztBQUNoQzVDLFlBQU00QyxNQUFNdkIsRUFBRSxtQkFBbUIsQ0FBQztBQUNsQyxZQUFNNEMsV0FBb0I7QUFBQSxRQUN4QlosTUFBTTtBQUFBLFFBQ05DLFNBQVMsVUFBVVYsTUFBTWEsVUFBVUssTUFBTWxCLE9BQU9vQixXQUFXcEIsTUFBTW9CLE9BQU87QUFBQSxNQUMxRTtBQUNBekMsa0JBQVksQ0FBQ2dDLFNBQVMsQ0FBQyxHQUFHQSxNQUFNVSxRQUFRLENBQUM7QUFBQSxJQUMzQyxVQUFDO0FBQ0N0QyxtQkFBYSxLQUFLO0FBQUEsSUFDcEI7QUFBQSxFQUNGO0FBRUEsU0FDRSx1QkFBQyxTQUFJLFdBQVUsa0NBQ2I7QUFBQSwyQkFBQyxTQUFJLFdBQVUsbURBQ2I7QUFBQSw2QkFBQyxRQUFHLFdBQVUsOENBQ1o7QUFBQSwrQkFBQyxPQUFJLFdBQVUsYUFBZjtBQUFBO0FBQUE7QUFBQTtBQUFBLGVBQXdCO0FBQUEsUUFBRztBQUFBLFFBQUVOLEVBQUUsUUFBUTtBQUFBLFdBRHpDO0FBQUE7QUFBQTtBQUFBO0FBQUEsYUFFQTtBQUFBLE1BRUEsdUJBQUMsVUFDQztBQUFBLCtCQUFDLGlCQUFjLFNBQU8sTUFDcEIsaUNBQUMsVUFBTyxTQUFRLFdBQVUsTUFBSyxNQUM3QjtBQUFBLGlDQUFDLGFBQVUsV0FBVSxrQkFBckI7QUFBQTtBQUFBO0FBQUE7QUFBQSxpQkFBbUM7QUFBQSxVQUFHO0FBQUEsVUFBRUEsRUFBRSxhQUFhO0FBQUEsYUFEekQ7QUFBQTtBQUFBO0FBQUE7QUFBQSxlQUVBLEtBSEY7QUFBQTtBQUFBO0FBQUE7QUFBQSxlQUlBO0FBQUEsUUFDQSx1QkFBQyxpQkFDQztBQUFBLGlDQUFDLGdCQUNDO0FBQUEsbUNBQUMsZUFBYUEsWUFBRSxpQkFBaUIsS0FBakM7QUFBQTtBQUFBO0FBQUE7QUFBQSxtQkFBbUM7QUFBQSxZQUNuQyx1QkFBQyxxQkFDRUEsWUFBRSxnQkFBZ0IsS0FEckI7QUFBQTtBQUFBO0FBQUE7QUFBQSxtQkFFQTtBQUFBLGVBSkY7QUFBQTtBQUFBO0FBQUE7QUFBQSxpQkFLQTtBQUFBLFVBQ0EsdUJBQUMsU0FBSSxXQUFVLGtCQUNiO0FBQUEsbUNBQUMsU0FBSSxXQUFVLGNBQ2I7QUFBQSxxQ0FBQyxTQUFPQSxZQUFFLGlCQUFpQixLQUEzQjtBQUFBO0FBQUE7QUFBQTtBQUFBLHFCQUE2QjtBQUFBLGNBQzdCO0FBQUEsZ0JBQUM7QUFBQTtBQUFBLGtCQUNDLE9BQU9RO0FBQUFBLGtCQUNQLFVBQVUsQ0FBQ3FDLE1BQVdwQyxnQkFBZ0JvQyxFQUFFQyxPQUFPQyxLQUFLO0FBQUEsa0JBQ3BELGFBQWEvQyxFQUFFLHVCQUF1QjtBQUFBLGtCQUN0QyxXQUFVO0FBQUE7QUFBQSxnQkFKWjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsY0FJa0I7QUFBQSxpQkFOcEI7QUFBQTtBQUFBO0FBQUE7QUFBQSxtQkFRQTtBQUFBLFlBQ0EsdUJBQUMsU0FBSSxXQUFVLGNBQ2I7QUFBQSxxQ0FBQyxTQUFPQSxZQUFFLGNBQWMsS0FBeEI7QUFBQTtBQUFBO0FBQUE7QUFBQSxxQkFBMEI7QUFBQSxjQUMxQjtBQUFBLGdCQUFDO0FBQUE7QUFBQSxrQkFDQyxPQUFPVTtBQUFBQSxrQkFDUCxVQUFVLENBQUNtQyxNQUFXbEMsVUFBVWtDLEVBQUVDLE9BQU9DLEtBQUs7QUFBQSxrQkFDOUMsTUFBSztBQUFBLGtCQUNMLGFBQWEvQyxFQUFFLG9CQUFvQjtBQUFBO0FBQUEsZ0JBSnJDO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxjQUl1QztBQUFBLGNBRXZDLHVCQUFDLE9BQUUsV0FBVSxpQ0FDVkE7QUFBQUEsa0JBQUUsYUFBYTtBQUFBLGdCQUFFO0FBQUEsZ0JBQUMsdUJBQUMsT0FBRSxNQUFLLDZCQUE0QixRQUFPLFVBQVMsV0FBVSxhQUFZLGdDQUExRTtBQUFBO0FBQUE7QUFBQTtBQUFBLHVCQUEwRjtBQUFBLG1CQUQvRztBQUFBO0FBQUE7QUFBQTtBQUFBLHFCQUVBO0FBQUEsaUJBVkY7QUFBQTtBQUFBO0FBQUE7QUFBQSxtQkFXQTtBQUFBLFlBQ0EsdUJBQUMsU0FBSSxXQUFVLGNBQ2I7QUFBQSxxQ0FBQyxTQUFPQSxZQUFFLGdCQUFnQixLQUExQjtBQUFBO0FBQUE7QUFBQTtBQUFBLHFCQUE0QjtBQUFBLGNBQzVCO0FBQUEsZ0JBQUM7QUFBQTtBQUFBLGtCQUNDLE9BQU9ZO0FBQUFBLGtCQUNQLFVBQVUsQ0FBQ2lDLE1BQVdoQyxTQUFTZ0MsRUFBRUMsT0FBT0MsS0FBSztBQUFBLGtCQUM3QyxhQUFhL0MsRUFBRSxzQkFBc0I7QUFBQTtBQUFBLGdCQUh2QztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsY0FHeUM7QUFBQSxpQkFMM0M7QUFBQTtBQUFBO0FBQUE7QUFBQSxtQkFPQTtBQUFBLFlBQ0EsdUJBQUMsVUFBTyxTQUFTcUIsWUFBWSxXQUFVLFVBQVVyQixZQUFFLFNBQVMsS0FBNUQ7QUFBQTtBQUFBO0FBQUE7QUFBQSxtQkFBOEQ7QUFBQSxlQTlCaEU7QUFBQTtBQUFBO0FBQUE7QUFBQSxpQkErQkE7QUFBQSxhQXRDRjtBQUFBO0FBQUE7QUFBQTtBQUFBLGVBdUNBO0FBQUEsV0E3Q0Y7QUFBQTtBQUFBO0FBQUE7QUFBQSxhQThDQTtBQUFBLFNBbkRGO0FBQUE7QUFBQTtBQUFBO0FBQUEsV0FvREE7QUFBQSxJQUVBLHVCQUFDLFFBQUssV0FBVSx3REFDZDtBQUFBLDZCQUFDLGNBQVcsV0FBVSxlQUNwQixpQ0FBQyxTQUFJLFdBQVUsYUFDWkM7QUFBQUEsaUJBQVNrQixXQUFXLEtBQ25CLHVCQUFDLFNBQUksV0FBVSwyQ0FDYjtBQUFBLGlDQUFDLE9BQUksV0FBVSx1Q0FBZjtBQUFBO0FBQUE7QUFBQTtBQUFBLGlCQUFrRDtBQUFBLFVBQ2xELHVCQUFDLE9BQUduQixZQUFFLFVBQVUsS0FBaEI7QUFBQTtBQUFBO0FBQUE7QUFBQSxpQkFBa0I7QUFBQSxhQUZwQjtBQUFBO0FBQUE7QUFBQTtBQUFBLGVBR0E7QUFBQSxRQUVEQyxTQUFTK0M7QUFBQUEsVUFBSSxDQUFDQyxLQUFLQyxNQUNsQjtBQUFBLFlBQUM7QUFBQTtBQUFBLGNBRUMsV0FBVyxRQUNURCxJQUFJakIsU0FBUyxTQUFTLGdCQUFnQixlQUFlO0FBQUEsY0FHdkQ7QUFBQSxnQkFBQztBQUFBO0FBQUEsa0JBQ0MsV0FBVywwQkFDVGlCLElBQUlqQixTQUFTLFNBQVMscUJBQXFCLFVBQVU7QUFBQSxrQkFHdkQ7QUFBQSwyQ0FBQyxTQUFJLFdBQVcsa0VBQ2RpQixJQUFJakIsU0FBUyxTQUFTLHVDQUF1QyxjQUFjLElBRTFFaUIsY0FBSWpCLFNBQVMsU0FBUyx1QkFBQyxRQUFLLFdBQVUsYUFBaEI7QUFBQTtBQUFBO0FBQUE7QUFBQSwyQkFBeUIsSUFBTSx1QkFBQyxPQUFJLFdBQVUsYUFBZjtBQUFBO0FBQUE7QUFBQTtBQUFBLDJCQUF3QixLQUhoRjtBQUFBO0FBQUE7QUFBQTtBQUFBLDJCQUlBO0FBQUEsb0JBQ0E7QUFBQSxzQkFBQztBQUFBO0FBQUEsd0JBQ0MsV0FBVyw4Q0FDVGlCLElBQUlqQixTQUFTLFNBQ1QsdUNBQ0EsMEJBQTBCO0FBQUEsd0JBRy9CaUIsY0FBSWhCO0FBQUFBO0FBQUFBLHNCQVBQO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxvQkFRQTtBQUFBO0FBQUE7QUFBQSxnQkFsQkY7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBLGNBbUJBO0FBQUE7QUFBQSxZQXhCS2lCO0FBQUFBLFlBRFA7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxVQTBCQTtBQUFBLFFBQ0Q7QUFBQSxRQUNBN0MsYUFDRSx1QkFBQyxTQUFJLFdBQVUsc0JBQ2IsaUNBQUMsU0FBSSxXQUFVLG1EQUNaTCxZQUFFLGFBQWEsS0FEbEI7QUFBQTtBQUFBO0FBQUE7QUFBQSxlQUVBLEtBSEY7QUFBQTtBQUFBO0FBQUE7QUFBQSxlQUlBO0FBQUEsUUFFSCx1QkFBQyxTQUFJLEtBQUtPLGFBQVY7QUFBQTtBQUFBO0FBQUE7QUFBQSxlQUFvQjtBQUFBLFdBM0N0QjtBQUFBO0FBQUE7QUFBQTtBQUFBLGFBNENBLEtBN0NGO0FBQUE7QUFBQTtBQUFBO0FBQUEsYUE4Q0E7QUFBQSxNQUVBLHVCQUFDLFNBQUksV0FBVSx3QkFDYjtBQUFBO0FBQUEsVUFBQztBQUFBO0FBQUEsWUFDQyxPQUFPSjtBQUFBQSxZQUNQLFVBQVUsQ0FBQzBDLE1BQVd6QyxTQUFTeUMsRUFBRUMsT0FBT0MsS0FBSztBQUFBLFlBQzdDLFdBQVcsQ0FBQ0YsTUFBV0EsRUFBRU0sUUFBUSxXQUFXLENBQUNOLEVBQUVPLFlBQVl0QixXQUFXO0FBQUEsWUFDdEUsYUFBYTlCLEVBQUUsZ0JBQWdCO0FBQUEsWUFDL0IsVUFBVUs7QUFBQUEsWUFDVixXQUFVO0FBQUE7QUFBQSxVQU5aO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxRQU1vQjtBQUFBLFFBRXBCLHVCQUFDLFVBQU8sU0FBU3lCLFlBQVksVUFBVXpCLFdBQ3JDLGlDQUFDLFFBQUssV0FBVSxhQUFoQjtBQUFBO0FBQUE7QUFBQTtBQUFBLGVBQXlCLEtBRDNCO0FBQUE7QUFBQTtBQUFBO0FBQUEsZUFFQTtBQUFBLFdBWEY7QUFBQTtBQUFBO0FBQUE7QUFBQSxhQVlBO0FBQUEsU0E3REY7QUFBQTtBQUFBO0FBQUE7QUFBQSxXQThEQTtBQUFBLE9BckhGO0FBQUE7QUFBQTtBQUFBO0FBQUEsU0FzSEE7QUFFSjtBQUFDTixHQXZPdUJELFNBQU87QUFBQSxVQUNmcEIsY0FBYztBQUFBO0FBQUEyRSxLQUROdkQ7QUFBTyxJQUFBdUQ7QUFBQUMsYUFBQUQsSUFBQSIsIm5hbWVzIjpbInVzZVN0YXRlIiwidXNlUmVmIiwidXNlRWZmZWN0IiwidXNlVHJhbnNsYXRpb24iLCJ0b2FzdCIsIkJ1dHRvbiIsIklucHV0IiwiU2Nyb2xsQXJlYSIsIkNhcmQiLCJTZW5kIiwiQm90IiwiVXNlciIsIlNldHRpbmdzMiIsImF4aW9zIiwiZGIiLCJEaWFsb2ciLCJEaWFsb2dDb250ZW50IiwiRGlhbG9nSGVhZGVyIiwiRGlhbG9nVGl0bGUiLCJEaWFsb2dUcmlnZ2VyIiwiRGlhbG9nRGVzY3JpcHRpb24iLCJMYWJlbCIsIlRleHRhcmVhIiwiQWlBZ2VudCIsIl9zIiwidCIsIm1lc3NhZ2VzIiwic2V0TWVzc2FnZXMiLCJpbnB1dCIsInNldElucHV0IiwiaXNMb2FkaW5nIiwic2V0SXNMb2FkaW5nIiwic2Nyb2xsUmVmIiwic3lzdGVtUHJvbXB0Iiwic2V0U3lzdGVtUHJvbXB0IiwiYXBpS2V5Iiwic2V0QXBpS2V5IiwibW9kZWwiLCJzZXRNb2RlbCIsImxvYWRTZXR0aW5ncyIsInNldHRpbmdzIiwiZ2V0U2V0dGluZ3MiLCJoaXN0b3J5IiwiZ2V0Q2hhdEhpc3RvcnkiLCJsZW5ndGgiLCJzYXZlQ2hhdEhpc3RvcnkiLCJzYXZlQ29uZmlnIiwidHJpbSIsImVycm9yIiwic2F2ZVNldHRpbmdzIiwic3VjY2VzcyIsImNvbnNvbGUiLCJjdXJyZW50Iiwic2Nyb2xsSW50b1ZpZXciLCJiZWhhdmlvciIsImhhbmRsZVNlbmQiLCJ1c2VyTXNnIiwicm9sZSIsImNvbnRlbnQiLCJwcmV2IiwiY29udmVyc2F0aW9uIiwicmVzcG9uc2UiLCJwb3N0Iiwic3RyZWFtIiwiaGVhZGVycyIsImFpTXNnIiwiZGF0YSIsImNob2ljZXMiLCJtZXNzYWdlIiwiZXJyb3JNc2ciLCJlIiwidGFyZ2V0IiwidmFsdWUiLCJtYXAiLCJtc2ciLCJpIiwia2V5Iiwic2hpZnRLZXkiLCJfYyIsIiRSZWZyZXNoUmVnJCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlcyI6WyJBaUFnZW50LnRzeCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyB1c2VTdGF0ZSwgdXNlUmVmLCB1c2VFZmZlY3QgfSBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCB7IHVzZVRyYW5zbGF0aW9uIH0gZnJvbSBcInJlYWN0LWkxOG5leHRcIjtcbmltcG9ydCB7IHRvYXN0IH0gZnJvbSBcInNvbm5lclwiO1xuaW1wb3J0IHsgQnV0dG9uIH0gZnJvbSBcIkAvY29tcG9uZW50cy91aS9idXR0b25cIjtcbmltcG9ydCB7IElucHV0IH0gZnJvbSBcIkAvY29tcG9uZW50cy91aS9pbnB1dFwiO1xuaW1wb3J0IHsgU2Nyb2xsQXJlYSB9IGZyb20gXCJAL2NvbXBvbmVudHMvdWkvc2Nyb2xsLWFyZWFcIjtcbmltcG9ydCB7IENhcmQgfSBmcm9tIFwiQC9jb21wb25lbnRzL3VpL2NhcmRcIjtcbmltcG9ydCB7IFNlbmQsIEJvdCwgVXNlciwgU2V0dGluZ3MyIH0gZnJvbSBcImx1Y2lkZS1yZWFjdFwiO1xuaW1wb3J0IGF4aW9zIGZyb20gXCJheGlvc1wiO1xuaW1wb3J0IHsgZGIgfSBmcm9tIFwiQC9saWIvZGJcIjtcbmltcG9ydCB7XG4gIERpYWxvZyxcbiAgRGlhbG9nQ29udGVudCxcbiAgRGlhbG9nSGVhZGVyLFxuICBEaWFsb2dUaXRsZSxcbiAgRGlhbG9nVHJpZ2dlcixcbiAgRGlhbG9nRGVzY3JpcHRpb24sXG59IGZyb20gXCJAL2NvbXBvbmVudHMvdWkvZGlhbG9nXCI7XG5pbXBvcnQgeyBMYWJlbCB9IGZyb20gXCJAL2NvbXBvbmVudHMvdWkvbGFiZWxcIjtcbmltcG9ydCB7IFRleHRhcmVhIH0gZnJvbSBcIkAvY29tcG9uZW50cy91aS90ZXh0YXJlYVwiO1xuXG5pbnRlcmZhY2UgTWVzc2FnZSB7XG4gIHJvbGU6IFwidXNlclwiIHwgXCJhc3Npc3RhbnRcIiB8IFwic3lzdGVtXCI7XG4gIGNvbnRlbnQ6IHN0cmluZztcbn1cblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gQWlBZ2VudCgpIHtcbiAgY29uc3QgeyB0IH0gPSB1c2VUcmFuc2xhdGlvbigpO1xuICBjb25zdCBbbWVzc2FnZXMsIHNldE1lc3NhZ2VzXSA9IHVzZVN0YXRlPE1lc3NhZ2VbXT4oW10pO1xuICBjb25zdCBbaW5wdXQsIHNldElucHV0XSA9IHVzZVN0YXRlKFwiXCIpO1xuICBjb25zdCBbaXNMb2FkaW5nLCBzZXRJc0xvYWRpbmddID0gdXNlU3RhdGUoZmFsc2UpO1xuICBjb25zdCBzY3JvbGxSZWYgPSB1c2VSZWY8SFRNTERpdkVsZW1lbnQ+KG51bGwpO1xuICBcbiAgLy8gTW9kZWwgQ29uZmlnXG4gIGNvbnN0IFtzeXN0ZW1Qcm9tcHQsIHNldFN5c3RlbVByb21wdF0gPSB1c2VTdGF0ZShcIuS9oOaYr+S4gOS4quS5kOS6juWKqeS6uueahEFJ5Yqp5omL44CCXCIpO1xuICBjb25zdCBbYXBpS2V5LCBzZXRBcGlLZXldID0gdXNlU3RhdGUoXCIxMmIzY2Y1MWJhMDY0YTQ2YjY4ZWNjNmJiZDViMzFlYy5rd2E5eVBvVUl4RHhKMTZKXCIpO1xuICBjb25zdCBbbW9kZWwsIHNldE1vZGVsXSA9IHVzZVN0YXRlKFwiZ2xtLTQtZmxhc2hcIik7IFxuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgLy8gTG9hZCBzZXR0aW5ncyBmcm9tIERCXG4gICAgY29uc3QgbG9hZFNldHRpbmdzID0gYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc2V0dGluZ3MgPSBhd2FpdCBkYi5nZXRTZXR0aW5ncygpO1xuICAgICAgaWYgKHNldHRpbmdzLmFwaUtleSkgc2V0QXBpS2V5KHNldHRpbmdzLmFwaUtleSk7XG4gICAgICBpZiAoc2V0dGluZ3MubW9kZWwpIHNldE1vZGVsKHNldHRpbmdzLm1vZGVsKTtcbiAgICAgIGlmIChzZXR0aW5ncy5zeXN0ZW1Qcm9tcHQpIHNldFN5c3RlbVByb21wdChzZXR0aW5ncy5zeXN0ZW1Qcm9tcHQpO1xuICAgICAgXG4gICAgICAvLyBMb2FkIGNoYXQgaGlzdG9yeVxuICAgICAgY29uc3QgaGlzdG9yeSA9IGF3YWl0IGRiLmdldENoYXRIaXN0b3J5KCk7XG4gICAgICBpZiAoaGlzdG9yeSAmJiBoaXN0b3J5Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgc2V0TWVzc2FnZXMoaGlzdG9yeSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBsb2FkU2V0dGluZ3MoKTtcbiAgfSwgW10pO1xuXG4gIC8vIFNhdmUgY2hhdCBoaXN0b3J5IHdoZW4gbWVzc2FnZXMgY2hhbmdlXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKG1lc3NhZ2VzLmxlbmd0aCA+IDApIHtcbiAgICAgIGRiLnNhdmVDaGF0SGlzdG9yeShtZXNzYWdlcyk7XG4gICAgfVxuICB9LCBbbWVzc2FnZXNdKTtcblxuICBjb25zdCBzYXZlQ29uZmlnID0gYXN5bmMgKCkgPT4ge1xuICAgIGlmICghYXBpS2V5LnRyaW0oKSkge1xuICAgICAgdG9hc3QuZXJyb3IodChcImFpLmtleS5lbXB0eVwiKSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICBhd2FpdCBkYi5zYXZlU2V0dGluZ3MoeyBhcGlLZXksIG1vZGVsLCBzeXN0ZW1Qcm9tcHQgfSk7XG4gICAgICB0b2FzdC5zdWNjZXNzKHQoXCJhaS5jb25maWcuc2F2ZWRcIikpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiU2F2ZSBjb25maWcgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgIHRvYXN0LmVycm9yKHQoXCJhaS5jb25maWcuZmFpbGVkXCIpKTtcbiAgICB9XG4gIH07XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAoc2Nyb2xsUmVmLmN1cnJlbnQpIHtcbiAgICAgIHNjcm9sbFJlZi5jdXJyZW50LnNjcm9sbEludG9WaWV3KHsgYmVoYXZpb3I6IFwic21vb3RoXCIgfSk7XG4gICAgfVxuICB9LCBbbWVzc2FnZXNdKTtcblxuICBjb25zdCBoYW5kbGVTZW5kID0gYXN5bmMgKCkgPT4ge1xuICAgIGlmICghaW5wdXQudHJpbSgpKSByZXR1cm47XG4gICAgaWYgKCFhcGlLZXkpIHtcbiAgICAgIHRvYXN0LmVycm9yKHQoXCJhaS5rZXkubWlzc2luZ1wiKSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgdXNlck1zZzogTWVzc2FnZSA9IHsgcm9sZTogXCJ1c2VyXCIsIGNvbnRlbnQ6IGlucHV0IH07XG4gICAgc2V0TWVzc2FnZXMoKHByZXYpID0+IFsuLi5wcmV2LCB1c2VyTXNnXSk7XG4gICAgc2V0SW5wdXQoXCJcIik7XG4gICAgc2V0SXNMb2FkaW5nKHRydWUpO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvbnZlcnNhdGlvbiA9IFtcbiAgICAgICAgeyByb2xlOiBcInN5c3RlbVwiLCBjb250ZW50OiBzeXN0ZW1Qcm9tcHQgfSxcbiAgICAgICAgLi4ubWVzc2FnZXMsXG4gICAgICAgIHVzZXJNc2dcbiAgICAgIF07XG5cbiAgICAgIC8vIFpoaXB1IEFJIEVuZHBvaW50XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGF4aW9zLnBvc3QoXG4gICAgICAgIFwiaHR0cHM6Ly9vcGVuLmJpZ21vZGVsLmNuL2FwaS9wYWFzL3Y0L2NoYXQvY29tcGxldGlvbnNcIixcbiAgICAgICAge1xuICAgICAgICAgIG1vZGVsOiBtb2RlbCxcbiAgICAgICAgICBtZXNzYWdlczogY29udmVyc2F0aW9uLFxuICAgICAgICAgIHN0cmVhbTogZmFsc2VcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgIFwiQXV0aG9yaXphdGlvblwiOiBgQmVhcmVyICR7YXBpS2V5fWAsXG4gICAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIlxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgY29uc3QgYWlNc2c6IE1lc3NhZ2UgPSB7XG4gICAgICAgIHJvbGU6IFwiYXNzaXN0YW50XCIsXG4gICAgICAgIGNvbnRlbnQ6IHJlc3BvbnNlLmRhdGEuY2hvaWNlc1swXS5tZXNzYWdlLmNvbnRlbnRcbiAgICAgIH07XG4gICAgICBzZXRNZXNzYWdlcygocHJldikgPT4gWy4uLnByZXYsIGFpTXNnXSk7XG5cbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiQUkgRXJyb3I6XCIsIGVycm9yKTtcbiAgICAgIHRvYXN0LmVycm9yKHQoXCJhaS5yZXF1ZXN0LmZhaWxlZFwiKSk7XG4gICAgICBjb25zdCBlcnJvck1zZzogTWVzc2FnZSA9IHtcbiAgICAgICAgcm9sZTogXCJhc3Npc3RhbnRcIixcbiAgICAgICAgY29udGVudDogYEVycm9yOiAke2Vycm9yLnJlc3BvbnNlPy5kYXRhPy5lcnJvcj8ubWVzc2FnZSB8fCBlcnJvci5tZXNzYWdlfWBcbiAgICAgIH07XG4gICAgICBzZXRNZXNzYWdlcygocHJldikgPT4gWy4uLnByZXYsIGVycm9yTXNnXSk7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHNldElzTG9hZGluZyhmYWxzZSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiAoXG4gICAgPGRpdiBjbGFzc05hbWU9XCJmbGV4IGZsZXgtY29sIGgtZnVsbCBzcGFjZS15LTRcIj5cbiAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIGJvcmRlci1iIHBiLTRcIj5cbiAgICAgICAgPGgyIGNsYXNzTmFtZT1cInRleHQtMnhsIGZvbnQtYm9sZCBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMlwiPlxuICAgICAgICAgIDxCb3QgY2xhc3NOYW1lPVwiaC02IHctNlwiIC8+IHt0KFwibmF2LmFpXCIpfVxuICAgICAgICA8L2gyPlxuICAgICAgICBcbiAgICAgICAgPERpYWxvZz5cbiAgICAgICAgICA8RGlhbG9nVHJpZ2dlciBhc0NoaWxkPlxuICAgICAgICAgICAgPEJ1dHRvbiB2YXJpYW50PVwib3V0bGluZVwiIHNpemU9XCJzbVwiPlxuICAgICAgICAgICAgICA8U2V0dGluZ3MyIGNsYXNzTmFtZT1cImgtNCB3LTQgbXItMlwiIC8+IHt0KFwiYWkuc2V0dGluZ3NcIil9XG4gICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICA8L0RpYWxvZ1RyaWdnZXI+XG4gICAgICAgICAgPERpYWxvZ0NvbnRlbnQ+XG4gICAgICAgICAgICA8RGlhbG9nSGVhZGVyPlxuICAgICAgICAgICAgICA8RGlhbG9nVGl0bGU+e3QoXCJhaS5jb25maWcudGl0bGVcIil9PC9EaWFsb2dUaXRsZT5cbiAgICAgICAgICAgICAgPERpYWxvZ0Rlc2NyaXB0aW9uPlxuICAgICAgICAgICAgICAgIHt0KFwiYWkuY29uZmlnLmRlc2NcIil9XG4gICAgICAgICAgICAgIDwvRGlhbG9nRGVzY3JpcHRpb24+XG4gICAgICAgICAgICA8L0RpYWxvZ0hlYWRlcj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwic3BhY2UteS00IHB5LTRcIj5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJncmlkIGdhcC0yXCI+XG4gICAgICAgICAgICAgICAgPExhYmVsPnt0KFwiYWkuc3lzdGVtLmxhYmVsXCIpfTwvTGFiZWw+XG4gICAgICAgICAgICAgICAgPFRleHRhcmVhIFxuICAgICAgICAgICAgICAgICAgdmFsdWU9e3N5c3RlbVByb21wdH1cbiAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZTogYW55KSA9PiBzZXRTeXN0ZW1Qcm9tcHQoZS50YXJnZXQudmFsdWUpfVxuICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9e3QoXCJhaS5zeXN0ZW0ucGxhY2Vob2xkZXJcIil9XG4gICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJoLTI0XCJcbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJncmlkIGdhcC0yXCI+XG4gICAgICAgICAgICAgICAgPExhYmVsPnt0KFwiYWkua2V5LmxhYmVsXCIpfTwvTGFiZWw+XG4gICAgICAgICAgICAgICAgPElucHV0IFxuICAgICAgICAgICAgICAgICAgdmFsdWU9e2FwaUtleX1cbiAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZTogYW55KSA9PiBzZXRBcGlLZXkoZS50YXJnZXQudmFsdWUpfVxuICAgICAgICAgICAgICAgICAgdHlwZT1cInBhc3N3b3JkXCJcbiAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPXt0KFwiYWkua2V5LnBsYWNlaG9sZGVyXCIpfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPVwidGV4dC14cyB0ZXh0LW11dGVkLWZvcmVncm91bmRcIj5cbiAgICAgICAgICAgICAgICAgIHt0KFwiYWkua2V5LmhlbHBcIil9IDxhIGhyZWY9XCJodHRwczovL29wZW4uYmlnbW9kZWwuY24vXCIgdGFyZ2V0PVwiX2JsYW5rXCIgY2xhc3NOYW1lPVwidW5kZXJsaW5lXCI+b3Blbi5iaWdtb2RlbC5jbjwvYT5cbiAgICAgICAgICAgICAgICA8L3A+XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImdyaWQgZ2FwLTJcIj5cbiAgICAgICAgICAgICAgICA8TGFiZWw+e3QoXCJhaS5tb2RlbC5sYWJlbFwiKX08L0xhYmVsPlxuICAgICAgICAgICAgICAgIDxJbnB1dCBcbiAgICAgICAgICAgICAgICAgIHZhbHVlPXttb2RlbH1cbiAgICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZTogYW55KSA9PiBzZXRNb2RlbChlLnRhcmdldC52YWx1ZSl9XG4gICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj17dChcImFpLm1vZGVsLnBsYWNlaG9sZGVyXCIpfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9e3NhdmVDb25maWd9IGNsYXNzTmFtZT1cInctZnVsbFwiPnt0KFwiYWkuc2F2ZVwiKX08L0J1dHRvbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDwvRGlhbG9nQ29udGVudD5cbiAgICAgICAgPC9EaWFsb2c+XG4gICAgICA8L2Rpdj5cblxuICAgICAgPENhcmQgY2xhc3NOYW1lPVwiZmxleC0xIHAtNCBvdmVyZmxvdy1oaWRkZW4gZmxleCBmbGV4LWNvbCBiZy1tdXRlZC8zMFwiPlxuICAgICAgICA8U2Nyb2xsQXJlYSBjbGFzc05hbWU9XCJmbGV4LTEgcHItNFwiPlxuICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPVwic3BhY2UteS00XCI+XG4gICAgICAgICAgICB7bWVzc2FnZXMubGVuZ3RoID09PSAwICYmIChcbiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9XCJ0ZXh0LWNlbnRlciB0ZXh0LW11dGVkLWZvcmVncm91bmQgbXQtMjBcIj5cbiAgICAgICAgICAgICAgICA8Qm90IGNsYXNzTmFtZT1cImgtMTIgdy0xMiBteC1hdXRvIG1iLTQgb3BhY2l0eS01MFwiIC8+XG4gICAgICAgICAgICAgICAgPHA+e3QoXCJhaS5zdGFydFwiKX08L3A+XG4gICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICAgIHttZXNzYWdlcy5tYXAoKG1zZywgaSkgPT4gKFxuICAgICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgICAga2V5PXtpfVxuICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17YGZsZXggJHtcbiAgICAgICAgICAgICAgICAgIG1zZy5yb2xlID09PSBcInVzZXJcIiA/IFwianVzdGlmeS1lbmRcIiA6IFwianVzdGlmeS1zdGFydFwiXG4gICAgICAgICAgICAgICAgfWB9XG4gICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2BmbGV4IGdhcC0zIG1heC13LVs4MCVdICR7XG4gICAgICAgICAgICAgICAgICAgIG1zZy5yb2xlID09PSBcInVzZXJcIiA/IFwiZmxleC1yb3ctcmV2ZXJzZVwiIDogXCJmbGV4LXJvd1wiXG4gICAgICAgICAgICAgICAgICB9YH1cbiAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT17YGgtOCB3LTggcm91bmRlZC1mdWxsIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHNocmluay0wICR7XG4gICAgICAgICAgICAgICAgICAgIG1zZy5yb2xlID09PSBcInVzZXJcIiA/IFwiYmctcHJpbWFyeSB0ZXh0LXByaW1hcnktZm9yZWdyb3VuZFwiIDogXCJiZy1zZWNvbmRhcnlcIlxuICAgICAgICAgICAgICAgICAgfWB9PlxuICAgICAgICAgICAgICAgICAgICB7bXNnLnJvbGUgPT09IFwidXNlclwiID8gPFVzZXIgY2xhc3NOYW1lPVwiaC01IHctNVwiIC8+IDogPEJvdCBjbGFzc05hbWU9XCJoLTUgdy01XCIgLz59XG4gICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtgcC0zIHJvdW5kZWQtbGcgdGV4dC1zbSB3aGl0ZXNwYWNlLXByZS13cmFwICR7XG4gICAgICAgICAgICAgICAgICAgICAgbXNnLnJvbGUgPT09IFwidXNlclwiXG4gICAgICAgICAgICAgICAgICAgICAgICA/IFwiYmctcHJpbWFyeSB0ZXh0LXByaW1hcnktZm9yZWdyb3VuZFwiXG4gICAgICAgICAgICAgICAgICAgICAgICA6IFwiYmctY2FyZCBib3JkZXIgc2hhZG93LXNtXCJcbiAgICAgICAgICAgICAgICAgICAgfWB9XG4gICAgICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgICAgIHttc2cuY29udGVudH1cbiAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICkpfVxuICAgICAgICAgICAge2lzTG9hZGluZyAmJiAoXG4gICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImZsZXgganVzdGlmeS1zdGFydFwiPlxuICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImJnLWNhcmQgYm9yZGVyIHAtMyByb3VuZGVkLWxnIHRleHQtc20gc2hhZG93LXNtXCI+XG4gICAgICAgICAgICAgICAgICAge3QoXCJhaS50aGlua2luZ1wiKX1cbiAgICAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICl9XG4gICAgICAgICAgICA8ZGl2IHJlZj17c2Nyb2xsUmVmfSAvPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8L1Njcm9sbEFyZWE+XG4gICAgICAgIFxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInB0LTQgbXQtMiBmbGV4IGdhcC0yXCI+XG4gICAgICAgICAgPFRleHRhcmVhIFxuICAgICAgICAgICAgdmFsdWU9e2lucHV0fVxuICAgICAgICAgICAgb25DaGFuZ2U9eyhlOiBhbnkpID0+IHNldElucHV0KGUudGFyZ2V0LnZhbHVlKX1cbiAgICAgICAgICAgIG9uS2V5RG93bj17KGU6IGFueSkgPT4gZS5rZXkgPT09IFwiRW50ZXJcIiAmJiAhZS5zaGlmdEtleSAmJiBoYW5kbGVTZW5kKCl9XG4gICAgICAgICAgICBwbGFjZWhvbGRlcj17dChcImFpLnBsYWNlaG9sZGVyXCIpfVxuICAgICAgICAgICAgZGlzYWJsZWQ9e2lzTG9hZGluZ31cbiAgICAgICAgICAgIGNsYXNzTmFtZT1cImZsZXgtMVwiXG4gICAgICAgICAgLz5cbiAgICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9e2hhbmRsZVNlbmR9IGRpc2FibGVkPXtpc0xvYWRpbmd9PlxuICAgICAgICAgICAgPFNlbmQgY2xhc3NOYW1lPVwiaC00IHctNFwiIC8+XG4gICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9DYXJkPlxuICAgIDwvZGl2PlxuICApO1xufSJdLCJmaWxlIjoiRDov5qGM6Z2i56uv5bqU55SocGx1cy9hcHAvc3JjL3BhZ2VzL0FpQWdlbnQudHN4In0=